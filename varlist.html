<!DOCTYPE html>
<head>
	<title>Hudder wiki - Variable list</title>
	<script src="base.js"></script>
	<meta charset="UTF-8">

	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-M0SCB1X0YP"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-M0SCB1X0YP');

		gtag('consent', 'update', {
			'ad_user_data': 'granted',
			'ad_personalization': 'granted',
			'ad_storage': 'granted',
			'analytics_storage': 'granted'
		});

	</script>
	<style>
	#searchbar {
		width: 20%;
		font-size: 1em;
		padding: 12px 20px 12px 12px;
		border: 1px solid #ddd;
		margin-bottom: 12px;
		color: white;
		background-color: rgb(0, 0, 0);
	}
	#searchbar::placeholder {
		color: darkgray;
		opacity: 1; /* Firefox */
	}
	</style>
</head>
<body onload="initializeTable()">
<note>Variables are NOT case sensitive</note>
<note id="hudder_version">PLACEHOLDER, if you see this something went wrong or is loading very slowly.</note>
<warning>If you are playing on an older version, some of those variables may not exist.</warning>

<script>

function httpGet(theUrl) {
	// create a new XMLHttpRequest object
	let xmlHttp = new XMLHttpRequest();
	
	// open a GET request with the URL
	xmlHttp.open("GET", theUrl, false);
	
	// send the request
	xmlHttp.send(null);
	
	// return the response as a string
	return xmlHttp.responseText;
}

/**
 * Strip JavaScript‐style comments (//… and /*…*​/) from a JSONC string,
 * then parse it as JSON.
 * Gippity made this BTW
 */
function parseJSONC(jsoncString) {
	// 1. Remove all /* … */ block comments
	const withoutBlockComments = jsoncString.replace(
		/\/\*[\s\S]*?\*\//g,
		''
	);
	
	// 2. Remove all // … line comments
	//    – the [^\n\r]* part grabs everything up to a newline
	const withoutAnyComments = withoutBlockComments.replace(
		/\/\/[^\n\r]*/g,
		''
	);
	
	// 3. Now feed the cleaned-up text to the standard JSON parser
	return JSON.parse(withoutAnyComments);
}

var variables_json = parseJSONC(httpGet("https://raw.githubusercontent.com/NGSpace/hudder/refs/heads/latest_release/src/main/resources/assets/hudder/variables.jsonc"));

document.getElementById("hudder_version").innerText = "This list is updated to Hudder version " + variables_json.hudder_version;

function updateSearch() {
	// Grab and normalize the user input
	const input = document.getElementById("searchbar");
	let filter = input.value.trim().toUpperCase();
	
	// Auto‐correct: if query mentions horse, pig, or llama, switch to "MOUNT"
	const keywords = ["HORSE", "PIG", "LLAMA"];
	if (keywords.some(k => filter.includes(k))) {
		filter = "MOUNT";
		console.log(`Auto-corrected search term to: ${filter}`);
	}

	const table = document.getElementById("var_table");
	const tr = table.getElementsByTagName("tr");
	let anyVisible = false;

	// Loop through all rows
	for (let i = 1; i < tr.length; i++) {
		const tds = tr[i].getElementsByTagName("td");
		let rowMatches = false;

		// Check each cell
		for (let j = 0; j < tds.length; j++) {
			const txtValue = (tds[j].textContent || tds[j].innerText).trim().toUpperCase();
			
			if (j === 2) {
				// 3rd column: exact match
				if (txtValue === filter && filter !== "") {
					rowMatches = true;
					break;
				}
			} else {
				// other columns: substring match
				if (txtValue.indexOf(filter) > -1) {
					rowMatches = true;
					break;
				}
			}
		}
		
		// Show/hide row
		tr[i].style.display = rowMatches ? "" : "none";
		if (rowMatches) anyVisible = true;
	}


	if (!anyVisible) {
		document.getElementById("res").innerText
			= "No variable found matching the search \""+input.value+'"'
		document.getElementById("searchnotfound").style.display = "";
	} else
		document.getElementById("searchnotfound").style.display = "none";
}



function initializeTable() {
	var table = (document.getElementById("var_table"));
	for (const type in variables_json) {
		if (type=="hudder_version") continue;
		var typelist = variables_json[type];
		for (const category in typelist) {
			var categorylist = typelist[category];
			for (var i = 0; i<categorylist.length; i++) {
				var value = categorylist[i];
				// Create an empty <tr> element and add it to the 1st position of the table:
				var row = table.insertRow(i+1);
				
				
				if (value.name==undefined) {
					console.log(i)
					console.log(category)
				}
				var name_cell = row.insertCell(0);
				name_cell.innerText = value.name;
				var desc_cell = row.insertCell(1);
				desc_cell.innerText = value.desc;
				var type_cell = row.insertCell(2);
				type_cell.innerText = type;
				var cate_cell = row.insertCell(3);
				cate_cell.innerText = category;
			}
		}
	}
	console.log("Done loading variable table");
	
	var input = document.getElementById('searchbar');
	input.focus();
	input.select();
}

</script>

<input type="text" id="searchbar" onkeyup="updateSearch()" placeholder="Search for a variable...">

<table id="var_table">
	<colgroup>
		<col span="1" style="width: 15%;">
		<col span="1" style="width: 50%;">
		<col span="1" style="width: 5%;">
		<col span="1" style="width: 20%;">
	</colgroup>

	<tr>
		<th>Function</th>
		<th width="30%">Description</th>
		<th>Type</th>
		<th>Category</th>
	</tr>
	
	<!-- Hidden third option -->
	<tr style="display:none;color: red;text-align: center;" id="searchnotfound">
		<th id="res" colspan="4">No variable found matching that search query</th>
	</tr>
</table>

<br><br><br>
</body>
